import{a as Re}from"./chunk-ADFA6PKI.js";import{a as ye,e as be,f as Me,g as Oe,h as Pe,i as ve,m as De}from"./chunk-2GMLSDXM.js";import{b as v,c as Ee,d as ke,e as Te}from"./chunk-VZPWKZ7S.js";import{a as Fe}from"./chunk-GQZ4J7UJ.js";import{$a as W,Aa as N,Ac as ge,Bc as fe,E as O,Ec as Ie,Fb as J,Fc as xe,G,Ga as Q,Gc as Se,Ha as $,Hb as P,Ia as H,J as B,Ja as y,Jc as Ce,Ka as b,Lc as we,N as _,O as g,Sa as X,U as A,Va as K,W as D,X as z,Xa as Y,Z as c,_ as C,ac as Z,ba as x,cc as ee,da as f,ec as te,fa as E,fc as ie,ga as U,gc as ne,ha as k,ia as T,ib as q,ja as r,ka as a,kc as oe,la as h,mc as re,na as w,nc as se,oa as d,oc as ae,pa as m,pc as le,qc as ce,rc as me,s as V,sa as j,sc as de,tc as pe,uc as he,v as F,wc as ue,xa as R,xc as _e,ya as u,za as I}from"./chunk-E5M5ZXR5.js";import{f as Ve,i as S}from"./chunk-E2I6K3L7.js";var Le=(()=>{let s=class s{constructor(){this.plaftorm=O(P)}transform(e,t=null,o="..."){let l=t!=null?t:this.getTextLengthUsingPlatform();return e.length>l?`${e.slice(0,Math.ceil(l)).trim()}${o}`:e}getTextLengthUsingPlatform(){return this.plaftorm.width()<500?30:this.plaftorm.width()<800?80:this.plaftorm.width()<1e3?100:300}};s.\u0275fac=function(t){return new(t||s)},s.\u0275pipe=B({name:"truncateText",type:s,pure:!0,standalone:!0});let n=s;return n})();var L=Ve(Fe());var Be=(n,s)=>s.id,Ae=()=>["Ok"],ze=n=>({hidden:n});function Ue(n,s){n&1&&(r(0,"ion-item",8)(1,"ion-avatar",9),h(2,"ion-skeleton-text"),a(),h(3,"ion-skeleton-text",10),a())}function je(n,s){if(n&1&&(r(0,"ion-list",3),k(1,Ue,4,0,"ion-item",8,U),a()),n&2){let i=m();c(),T(i.dummyArray)}}function Ne(n,s){if(n&1&&h(0,"ion-alert",11),n&2){let i=m();f("message",i.error)("buttons",$(2,Ae))}}function Qe(n,s){if(n&1){let i=w();r(0,"ion-item-sliding",12,0),d("ionDrag",function(t){let o=_(i).$index,l=R(1),p=m();return g(p.onItemDrag(t,l,o))}),r(2,"ion-item",13)(3,"ion-thumbnail",9),h(4,"img",14),a(),r(5,"ion-label",15)(6,"strong",16),u(7),y(8,"truncateText"),a(),r(9,"div",17),u(10),y(11,"truncateText"),a(),r(12,"div",18)(13,"ion-badge",19),u(14),y(15,"moment"),a(),r(16,"ion-badge",20),u(17),a()()()(),r(18,"ion-item-options",21)(19,"ion-item-option",22),d("click",function(){let t=_(i).$index,o=R(1),l=m();return g(l.handleOptionClick(o,t,"view"))}),h(20,"ion-icon",23),a()()()}if(n&2){let i=s.$implicit,e=m();c(2),f("href",i.url),c(2),j("alt",i.title),f("src",e.getImageUrl(i),D),c(3),I(b(8,7,i.title)),c(3),I(b(11,9,i.desc)),c(4),I(b(15,11,i.timestamp)),c(3),I(i.locationName)}}function $e(n,s){n&1&&(r(0,"ion-item",24)(1,"ion-label",25),u(2,"No data found"),a()())}function He(n,s){if(n&1&&x(0,$e,3,0,"ion-item",24),n&2){let i=m();E(0,i.isLoading?-1:0)}}function Xe(n,s){n&1&&h(0,"ion-spinner",42)}function Ke(n,s){if(n&1){let i=w();r(0,"div",39),x(1,Xe,1,0,"ion-spinner",40),r(2,"img",41),d("load",function(){_(i);let t=m(3);return g(t.onSelectedItemImageLoaded())}),a()()}if(n&2){let i=m(3);c(),f("ngIf",!i.selectedItemImageLoaded),c(),f("ngClass",H(3,ze,!i.selectedItemImageLoaded))("src",i.selectedItem.imageUrl,D)}}function Ye(n,s){if(n&1){let i=w();r(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),u(3),a()()(),r(4,"ion-content",27)(5,"div",28),x(6,Ke,3,5,"div",29),r(7,"p",30),u(8),a(),r(9,"h5")(10,"ion-badge",19),u(11),y(12,"moment"),a()(),r(13,"h5")(14,"ion-badge",20),u(15),a()(),r(16,"h5")(17,"ion-badge",31),u(18),a()(),r(19,"div",32)(20,"ion-button",33),d("click",function(){_(i);let t=m(2);return g(t.closeModal(null))}),h(21,"ion-icon",34),a(),r(22,"ion-button",35),d("click",function(){_(i);let t=m(2);return g(t.onSelectedItemGoClick(t.selectedItem))}),h(23,"ion-icon",36),a()(),r(24,"ion-icon",37),d("click",function(){_(i);let t=m(2);return g(t.previousItemDetail())}),a(),r(25,"ion-icon",38),d("click",function(){_(i);let t=m(2);return g(t.nextItemDetail())}),a()()()}if(n&2){let i=m(2);c(3),I(i.selectedItem.title),c(3),f("ngIf",i.selectedItem.imageUrl),c(2),N(" ",i.selectedItem.desc," "),c(3),I(b(12,6,i.selectedItem.timestamp)),c(4),I(i.selectedItem.locationName),c(3),I(i.selectedItem.source)}}function We(n,s){if(n&1){let i=w();r(0,"ion-modal",26),d("didDismiss",function(){_(i);let t=m();return g(t.closeModal(null))}),x(1,Ye,26,8,"ng-template"),a()}if(n&2){let i=m();f("isOpen",i.isModalOpen)}}var wt=(()=>{let s=class s{constructor(e,t,o,l){this.gestureCtrl=e,this.platform=t,this.el=o,this.cdRef=l,this.isLoading=!0,this.error=null,this.dummyArray=new Array(5),this.pageSize=10,this.currentPage=1,this.items=[],this.isModalOpen=!1,this.selectedItem=null,this.selectedIndex=-1,this.selectedSlidingItem=null,this.selectedItemImageLoaded=!1,this.apiService=O(Te),this.source=null,this.searchQuery="",this.searchCriteria=new Ee,this.searchSupportData=new ke,this.swipeActive=!1,this.imageSwipeGesture=null,this.detailSwipeGesture=null,ye({chevronForward:Pe,eye:De,arrowForwardCircle:Me,arrowBackCircle:be,close:ve,checkmarkCircle:Oe})}onSelectedItemImageLoaded(){this.selectedItemImageLoaded=!0}onSelectedItemImageLoadStart(){this.selectedItemImageLoaded=!1}ngOnInit(){this.searchCriteriaSubscription=this.apiService.searchCriteria$.subscribe(e=>{this.searchCriteria=e,this.refresh({searchQuery:this.searchCriteria.searchQuery})}),this.searchSupportDataSubscription=this.apiService.searchSupportData$.subscribe(e=>{this.searchSupportData=e})}ngOnDestroy(){this.searchCriteriaSubscription.unsubscribe(),this.searchSupportDataSubscription.unsubscribe()}buildSearchOption(){return{tags:this.searchCriteria.filterTags}}loadData(e){return S(this,null,function*(){this.error=null,e||(this.isLoading=!0),!L.isNil(e)&&!L.isNil(e.searchQuery)&&(this.searchQuery=e.searchQuery),this.apiService.getResult(this.searchQuery,this.source,this.currentPage,this.pageSize,this.buildSearchOption()).pipe(F(()=>{this.isLoading=!1}),V(t=>(this.error=t.error.status_message,[]))).subscribe({next:t=>{var o;this.currentPage==1?this.items=t:this.items.push(...t),this.apiService.setSearchSupportDataFilterTags(this.items),(o=e==null?void 0:e.target)==null||o.complete(),e&&e.target&&(e.target.disabled=this.currentPage===10)}})})}loadMore(e){return e?this.currentPage++:this.currentPage=1,this.loadData(e)}getImageUrl(e){return v.has(e.source)?v.get(e.source):!v.has(e.source)&&!e.imageUrl?"/assets/logo.png":e.imageUrl}refresh(e){this.isLoading=!0,this.currentPage=1,this.items=[],this.loadData(e)}closeModal(e){this.selectedSlidingItem&&this.selectedSlidingItem.close(),this.isModalOpen=!1,this.selectedItem=null,this.selectedIndex=-1,this.imageSwipeGesture&&(this.imageSwipeGesture.destroy(),this.imageSwipeGesture=null),this.detailSwipeGesture&&(this.detailSwipeGesture.destroy(),this.detailSwipeGesture=null)}onItemDetailSwipeStart(){this.cdRef.detectChanges()}onItemDetailSwipeEnd(e){let{type:t,currentX:o,deltaX:l,deltaY:p,velocityX:qe}=e,M=50;l>M?this.nextItemDetail():l<-M?this.previousItemDetail():p>M?this.previousItemDetail():p<-M&&this.nextItemDetail()}openModal(e){this.selectedIndex=e,this.selectedItem=this.items[this.selectedIndex],this.isModalOpen=!0;let t=document.getElementById("swipeImageArea"),o=document.getElementById("swipeArea");t&&(this.imageSwipeGesture=this.gestureCtrl.create({el:t,onStart:()=>this.onItemDetailSwipeStart(),onMove:l=>{},onEnd:l=>this.onItemDetailSwipeEnd(l),gestureName:"swipe-item-image"}),this.imageSwipeGesture.enable()),o&&(this.detailSwipeGesture=this.gestureCtrl.create({el:o,onStart:()=>this.onItemDetailSwipeStart(),onMove:l=>{},onEnd:l=>this.onItemDetailSwipeEnd(l),gestureName:"swipe-item-deatil"}),this.detailSwipeGesture.enable())}onItemDrag(e,t,o){return S(this,null,function*(){this.selectedSlidingItem=t,e.detail.ratio>.3&&(this.openModal(o),yield this.sleep(500),this.selectedSlidingItem&&this.selectedSlidingItem.close())})}sleep(e){return new Promise(t=>setTimeout(t,e))}handleOptionClick(e,t,o){this.selectedSlidingItem=e,o==="view"&&this.openModal(t)}onSelectedItemGoClick(e){window.open(e.url,"_blank")}previousItemDetail(){return S(this,null,function*(){this.isModalOpen&&(--this.selectedIndex,this.selectedIndex<0&&(this.selectedIndex=0,yield this.loadMore(null)),this.loadSelectedItem())})}nextItemDetail(){return S(this,null,function*(){this.isModalOpen&&(++this.selectedIndex,this.selectedIndex>=this.items.length&&(--this.selectedIndex,yield this.loadMore({})),this.loadSelectedItem())})}loadSelectedItem(){this.selectedItem=this.items[this.selectedIndex]}handleKeyEvent(e){switch(e.key){case"ArrowLeft":this.previousItemDetail();break;case"ArrowRight":this.nextItemDetail();break}}};s.\u0275fac=function(t){return new(t||s)(C(Ce),C(P),C(A),C(X))},s.\u0275cmp=G({type:s,selectors:[["search-result"]],hostBindings:function(t,o){t&1&&d("keydown",function(p){return o.handleKeyEvent(p)},!1,z)},inputs:{source:"source",searchQuery:"searchQuery"},standalone:!0,features:[Q],decls:11,vars:3,consts:[["slidingItem",""],["slot","fixed",3,"ionRefresh"],["pullingIcon","arrow-dropdown","pullingText","Pull to refresh","refreshingSpinner","circles","refreshingText","Refreshing..."],[1,"ion-padding-top"],["lines","all"],[3,"ionInfinite"],["loadingSpinner","bubbles","loadingText","Loading more data..."],[3,"isOpen","didDismiss",4,"ngIf"],["lines","none",1,"ion-padding-bottom"],["slot","start"],["animated","",2,"height","50px"],["header","Error","isOpen","true",3,"message","buttons"],[3,"ionDrag"],["detail","true","target","_blank",3,"href"],[3,"src","alt"],[1,"item-content"],[1,"item-title"],[1,"item-desc"],[1,"item-badges"],["color","tertiary"],["color","primary"],["side","end"],["color","danger","expandable","",3,"click"],["slot","bottom","name","eye"],["lines","none"],[1,"ion-text-center"],[3,"didDismiss","isOpen"],[1,"ion-padding"],["id","swipeArea",1,"swipe-container"],["class","image-container",4,"ngIf"],[1,"modal-description"],["color","warning"],[1,"action-buttons"],["shape","round","size","large","color","tertiary",3,"click"],["slot","icon-only","name","close"],["shape","round","size","large","color","primary",3,"click"],["slot","icon-only","name","checkmark-circle"],["color","primary","name","arrow-back-circle",1,"arrow","left-arrow",3,"click"],["color","primary","name","arrow-forward-circle",1,"arrow","right-arrow",3,"click"],[1,"image-container"],["name","crescent",4,"ngIf"],["onloadstart","onSelectedItemImageLoadStart","alt","Popup Image","id","swipeImageArea",3,"load","ngClass","src"],["name","crescent"]],template:function(t,o){t&1&&(r(0,"ion-refresher",1),d("ionRefresh",function(p){return o.refresh(p)}),h(1,"ion-refresher-content",2),a(),x(2,je,3,0,"ion-list",3)(3,Ne,1,3),r(4,"ion-list",4),k(5,Qe,21,13,"ion-item-sliding",null,Be,!1,He,1,1),a(),r(8,"ion-infinite-scroll",5),d("ionInfinite",function(p){return o.loadMore(p)}),h(9,"ion-infinite-scroll-content",6),a(),x(10,We,2,1,"ion-modal",7)),t&2&&(c(2),E(2,o.isLoading?2:o.error?3:-1),c(3),T(o.items),c(5),f("ngIf",o.selectedItem))},dependencies:[re,Se,xe,oe,pe,ie,te,de,me,ce,le,he,se,ae,ge,ee,we,Ie,ue,_e,Z,fe,W,K,Y,Re,Le,ne,J,q],styles:[".image-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100%}.image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:80%;max-height:60%;border-radius:5px}.swipe-container[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{position:absolute;top:40%;transform:translateY(-50%);font-size:2.5rem;cursor:pointer}.swipe-container[_ngcontent-%COMP%]   .left-arrow[_ngcontent-%COMP%]{left:10px}.swipe-container[_ngcontent-%COMP%]   .right-arrow[_ngcontent-%COMP%]{right:10px}.action-buttons[_ngcontent-%COMP%]{display:flex;justify-content:center}.hidden[_ngcontent-%COMP%]{display:none}ion-item[_ngcontent-%COMP%]{--min-height: auto;padding-top:6px;padding-bottom:6px}ion-item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{width:60px;height:60px}ion-item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;border-radius:4px}ion-item[_ngcontent-%COMP%]   .item-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;gap:4px}ion-item[_ngcontent-%COMP%]   .item-content[_ngcontent-%COMP%]   .item-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;margin:0}ion-item[_ngcontent-%COMP%]   .item-content[_ngcontent-%COMP%]   .item-desc[_ngcontent-%COMP%]{font-size:.85rem;color:var(--ion-text-color-secondary);margin:0}ion-item[_ngcontent-%COMP%]   .item-content[_ngcontent-%COMP%]   .item-badges[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}ion-item[_ngcontent-%COMP%]   .item-content[_ngcontent-%COMP%]   .item-badges[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{font-size:.7rem;line-height:1.2;width:fit-content}"]});let n=s;return n})();export{wt as a};
