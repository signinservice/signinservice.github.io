import{a as R}from"./chunk-FAY467QK.js";import"./chunk-3O2XMPDP.js";import"./chunk-QKZDKOWR.js";import"./chunk-672LKCSF.js";import{e as q}from"./chunk-TEIVXAVQ.js";import"./chunk-YP7JNQMV.js";import{a as z}from"./chunk-GQZ4J7UJ.js";import{$a as _,$b as O,Aa as D,Ab as E,Bb as N,Eb as V,Fc as G,G as b,Ga as I,Gb as T,Gc as K,Mc as M,Xa as F,Z as d,_ as p,ba as v,da as f,gc as j,hc as w,ja as l,ka as r,kc as L,la as g,mc as x,oa as S,pc as B,tc as P,ub as h,uc as k,vb as U,vc as A,wb as y,ya as m,zb as C}from"./chunk-E5M5ZXR5.js";import"./chunk-4K5LH2EL.js";import"./chunk-HC6MZPB3.js";import"./chunk-HWJT3G3M.js";import"./chunk-QA4BP4KE.js";import"./chunk-4PGTP63H.js";import"./chunk-W247SYNL.js";import"./chunk-5AWJTBLE.js";import"./chunk-R55QYPU7.js";import"./chunk-EBGJQX73.js";import"./chunk-MM5QLNJM.js";import"./chunk-3573TPBU.js";import"./chunk-2EOHHFOF.js";import"./chunk-JXIEZMHN.js";import"./chunk-ALJHSCNX.js";import"./chunk-MCRJI3T3.js";import"./chunk-ONMHOBBF.js";import"./chunk-6OWUBTX6.js";import"./chunk-DFV6G3P3.js";import"./chunk-LAKQI2GN.js";import"./chunk-36DK65CZ.js";import"./chunk-7M2JNTUM.js";import"./chunk-FIB3M2O7.js";import"./chunk-4U6PRYVA.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-IMRZMLQ3.js";import"./chunk-LF5XB4YN.js";import{f as J,i as u}from"./chunk-E2I6K3L7.js";var a=J(z());function H(c,s){c&1&&(l(0,"ion-note",9),m(1," Not Valid Url "),r())}function Z(c,s){c&1&&(l(0,"ion-note",9),m(1," Not Valid Url "),r())}var le=(()=>{let s=class s{constructor(o,t,e){this.fb=o,this.apiSrvice=t,this.toastService=e,this.loading=!1,this.saving=!1}ngOnInit(){this.configForm=this.fb.group({remoteDbUrl:["",[h.required,this.urlValidator]],localDbUrl:["",[h.required,this.urlValidator]]}),this.loadData()}urlValidator(o){let t=o.value;return t?/^(https?:\/\/)?([a-zA-Z0-9.-]+)(:[0-9]+)?(\/.*)?$/.test(t.trim())?null:{invalidUrl:!0}:null}loadData(){this.loading=!0,this.apiSrvice.getFile("serversettings.json").subscribe({next:o=>{this.configurationData=JSON.parse(o);let t=this.configurationData.ElasticSearch.Targets,e=a.find(t,i=>a.includes(i.Keys,"Remote")),n=a.find(t,i=>a.includes(i.Keys,"Local"));this.configForm.patchValue({remoteDbUrl:e.Url,localDbUrl:n.Url}),this.loading=!1},error:o=>u(this,null,function*(){yield this.toastService.error("Failed to load configuration"),this.loading=!1})})}saveForm(){if(this.configForm.invalid){this.configForm.markAllAsTouched();return}this.saving=!0;let o=this.configurationData.ElasticSearch.Targets,t=a.find(o,i=>a.includes(i.Keys,"Remote")),e=a.find(o,i=>a.includes(i.Keys,"Local"));t.Url=this.configForm.value.remoteDbUrl,e.Url=this.configForm.value.localDbUrl,this.configurationData.ElasticSearch.Targets=[t,e];let n=JSON.stringify(this.configurationData);this.apiSrvice.saveFile("serversettings.json","..",!0,n).subscribe({next:()=>u(this,null,function*(){return yield this.toastService.success("Saved On Premise successfully \u2705")}),error:()=>u(this,null,function*(){return yield this.toastService.error("Save On Premise failed \u274C")})}),this.apiSrvice.saveFile("serversettings.json","",!1,n).subscribe({next:()=>u(this,null,function*(){yield this.toastService.success("Saved On Cloud successfully \u2705"),this.saving=!1}),error:()=>u(this,null,function*(){return yield this.toastService.error("Save On Cloud failed \u274C")})})}};s.\u0275fac=function(t){return new(t||s)(p(V),p(q),p(R))},s.\u0275cmp=b({type:s,selectors:[["app-configuration"]],standalone:!0,features:[I],decls:22,vars:5,consts:[["slot","start"],[1,"ion-padding","full-height-content"],[3,"ngSubmit","formGroup"],["position","floating"],["formControlName","remoteDbUrl"],["color","danger",4,"ngIf"],["formControlName","localDbUrl"],[1,"spacer"],["type","submit","expand","block",3,"disabled"],["color","danger"]],template:function(t,e){if(t&1&&(l(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),g(3,"ion-back-button"),r(),l(4,"ion-title"),m(5,"Configuration"),r()()(),l(6,"ion-content",1)(7,"form",2),S("ngSubmit",function(){return e.saveForm()}),l(8,"ion-list")(9,"ion-item")(10,"ion-label",3),m(11,"Remote Database Url"),r(),g(12,"ion-input",4),r(),v(13,H,2,0,"ion-note",5),l(14,"ion-item")(15,"ion-label",3),m(16,"Local Database Url"),r(),g(17,"ion-input",6),r(),v(18,Z,2,0,"ion-note",5),r(),g(19,"div",7),l(20,"ion-button",8),m(21),r()()()),t&2){let n,i;d(7),f("formGroup",e.configForm),d(6),f("ngIf",((n=e.configForm.get("remoteDbUrl"))==null?null:n.hasError("urlValidator"))&&((n=e.configForm.get("remoteDbUrl"))==null?null:n.touched)),d(5),f("ngIf",((i=e.configForm.get("localDbUrl"))==null?null:i.hasError("urlValidator"))&&((i=e.configForm.get("localDbUrl"))==null?null:i.touched)),d(2),f("disabled",e.configForm.invalid||e.loading),d(),D(" ",e.loading?"Loading...":e.saving?"Saving...":"Save"," ")}},dependencies:[x,K,G,L,P,M,k,B,w,O,j,A,_,F,T,C,U,y,E,N]});let c=s;return c})();export{le as ConfigurationPage};
