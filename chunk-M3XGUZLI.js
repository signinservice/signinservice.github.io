import{a as l}from"./chunk-UBCSOUAF.js";import{a as A}from"./chunk-GQZ4J7UJ.js";import{A as g,E as f,c as $,cb as k,db as q,eb as j,k as U,l as v,s as p}from"./chunk-E5M5ZXR5.js";import{f as b,i as C}from"./chunk-E2I6K3L7.js";var u=b(A());var x=(()=>{let i=class i{constructor(){this.characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"}makeUniqueId(e=5){let t="",r=this.characters.length;for(var a=0;a<e;a++)t+=this.characters.charAt(Math.floor(Math.random()*r));return t}getPositionIndexInListForGoogleAd(){return u.random(8)}getEnvironmentSpecificPath(e){if(u.isNil(l.name))return e;{let t=u.split(e,"?")[0];t!=="/"&&t.endsWith("/")&&(t=t.slice(0,-1));let r=u.split(t,"/").filter(Boolean),a=u.last(r),o=r.slice(0,r.length-1);return(o.length>0?"/"+o.join("/"):"/")+"/"+l.name+"/"+a}}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=g({token:i,factory:i.\u0275fac,providedIn:"root"});let c=i;return c})();var H=new Map;H.set("gumtree-au","https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcS4IQXWycbFxHdo8Of-VfXxizLEjM3LawgEEpEGlfjmPA&usqp=CAU&ec=45702844");H.set("facebook","https://i.pinimg.com/736x/80/4d/39/804d3943dae3239f92626dae897f7554.jpg");var d=class{constructor(){this.searchQuery="",this.filterTags=[],this.source=""}},S=class{constructor(){this.filterTags=[]}};var I=b(A());var R=(()=>{let i=class i{constructor(){this.encrypCodeList=[{k:1,v:"am"},{k:2,v:"bi"},{k:3,v:"ch"},{k:4,v:"da"},{k:5,v:"ea"},{k:6,v:"fa"},{k:7,v:"ga"},{k:8,v:"hu"},{k:9,v:"in"},{k:0,v:"ja"}]}getHeaders(){let e=Math.ceil(Math.random()*9),t=this.getApiCallSignFactorKey(e),r=this.getApiCallSignatureKey(e);return new k({"x-api-call-sign-factor":t,"x-api-call-sign":r,Accept:"application/json"})}getApiCallSignFactorKey(e){let t="";return t=I.find(this.encrypCodeList,{k:e}).v,t}getApiCallSignatureKey(e){let t=new Date,r=t.getUTCMonth()+1,a=t.getUTCDate(),o=t.getUTCFullYear(),s=t.getUTCHours(),n=t.getUTCMinutes(),m=t.getUTCSeconds(),y=o+this.formatNumber(r)+this.formatNumber(a)+this.formatNumber(s)+this.formatNumber(n)+this.formatNumber(m);return(Number(y)*e).toString()}formatNumber(e){return e.toString().length==1?"0"+e.toString():e.toString()}getHttpRequestOptionArgs(e=""){let t=new q({fromString:e});return{headers:this.getHeaders(),params:t}}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=g({token:i,factory:i.\u0275fac,providedIn:"root"});let c=i;return c})();var h=b(A());var V=(()=>{let i=class i{setSearchCriteria(e){this.searchCriteria=e,this.searchCriteriaSubject.next(this.searchCriteria)}setSearchSupportData(e){this.searchSupportData=e,this.searchSupportDataSubject.next(this.searchSupportData)}setSearchSupportDataFilterTags(e){let t=h.map(e,"tags");this.searchSupportData.filterTags=this.flattenCategories(t,15),this.searchSupportDataSubject.next(this.searchSupportData)}flattenCategories(e,t){let r=new Set,a=0;for(;;){let o=!1;for(let n of e)n.length>a&&(r.add(n[a]),o=!0);let s=Array.from(r).sort();if(s.length>=t)return s.slice(0,t);if(!o)break;a++}return Array.from(r).sort()}constructor(){this.http=f(j),this.utilService=f(x),this.securityService=f(R),this.searchCriteria=new d,this.searchCriteriaSubject=new $(this.searchCriteria),this.searchCriteria$=this.searchCriteriaSubject.asObservable(),this.searchSupportData=new S,this.searchSupportDataSubject=new $(this.searchSupportData),this.searchSupportData$=this.searchSupportDataSubject.asObservable(),this.baseUrl="",this.targetQueryString="_target=Remote",this.setBaseUrl(l.apiBaseUrl)}setBaseUrl(e){this.baseUrl=e,this.baseUrl.substring(this.baseUrl.length-1)!=="/"&&(this.baseUrl=this.baseUrl+"/")}searchById(e,t,r="Local"){let a=`premisesearch/${e}`;r&&(a=`${a}?_target=${r}`);let o=this.makeApiPath(`${a}`),s=this.securityService.getHttpRequestOptionArgs();return this.http.post(o,{ids:t},s).toPromise()}getFile(e,t=""){let r=this.makeApiPath(`files?name=${e}&directory=${t}`);return this.http.get(r,this.securityService.getHttpRequestOptionArgs()).pipe(p(this.errorHandler))}saveFile(e,t="",r=!1,a=null){let o=r?"premisefiles":"files",s=this.makeApiPath(`${o}?name=${e}&directory=${t}`),n=this.securityService.getHttpRequestOptionArgs();return this.http.post(s,a,n).pipe(p(this.errorHandler))}getResult(e,t,r,a,o){let s=`${this.targetQueryString}&pageSize=${a}&page=${r}&${this.getUniqueRequestQueryString()}`;if(e&&(s=`${s}&query=${e}`),o){if(o.userGeoLocation){let{lat:n,lon:m}=o.userGeoLocation;s=`${s}&gl=${n},${m}`}o.radius&&(s=`${s}&gr=${o.radius}`)}if(t?h.isArray(t)?h.forEach(t,n=>s=`${s}&aggValue=${n}`):s=`${s}&aggValue=${t}`:s=`${s}&index=${l.searchIndexPattern}`,!h.isNil(o)){let{tags:n}=o;if(h.isArray(n)){let m=n.map(y=>`tags=${encodeURIComponent(y.trim())}`).join("&");s=`${s}&${m}`}}return this.http.get(this.makeApiPath("search/latest"),this.securityService.getHttpRequestOptionArgs(s)).pipe(v(n=>this.formatSearchResult(n)),p(this.errorHandler))}getResultBySource(e){return this.http.get(this.makeApiPath(`search/latest?${this.targetQueryString}&query=`+e+`&${this.getUniqueRequestQueryString()}`),this.securityService.getHttpRequestOptionArgs()).pipe(v(t=>this.formatSearchResult(t)),p(this.errorHandler))}getSources(){let e=this.makeApiPath(`search/aggregrate/count?${this.targetQueryString}&aggField=source&index=${l.searchCategoryIndexPattern}&pageSize=50&${this.getUniqueRequestQueryString()}`);return this.http.get(e,this.securityService.getHttpRequestOptionArgs()).pipe(p(this.errorHandler))}formatSearchResult(e){let t=[];return h.forEach(e,r=>{let a={title:r.t,desc:r.d,id:r.id,source:r.s,imageUrl:r.i,url:r.u,timestamp:r.ts,locationName:r.l,geoLoc:r.gl,tags:r.tg};t.push(a)}),t}getUniqueRequestQueryString(){return`uuid=${this.utilService.makeUniqueId()}`}errorHandler(e){let t;return e.error instanceof ErrorEvent?t=`An error occurred: ${e.error.message}`:t=`Server returned code: ${e.status}, error message is: ${e.message}`,console.error(t),U(t)}queue(e,t){return C(this,null,function*(){let r=h.isArray(t)?JSON.stringify(t):"["+JSON.stringify(t)+"]",a=`queue?routingKey=${e}`,o=this.makeApiPath(`${a}`),s=this.securityService.getHttpRequestOptionArgs();return this.http.post(o,t,s).toPromise()})}makeApiPath(e){return`${this.baseUrl}${e}`}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=g({token:i,factory:i.\u0275fac,providedIn:"root"});let c=i;return c})();export{x as a,H as b,d as c,S as d,V as e};
